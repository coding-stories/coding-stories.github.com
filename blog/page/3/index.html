
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Coding Stories</title>
  <meta name="author" content="Jean-Christophe Sirot">

  
  <meta name="description" content="Problème : on dispose d’un bloc de données dont on désire calculer l’empreinte SHA-1. Deux solutions, sur Android et iOS. Android 1
2
3
4
5
6
import &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://coding-stories.github.com/blog/page/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Coding Stories" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24699653-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">cs</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Coding Stories</a></h1>
  
    <h2>Singe savant en ingénierie logicielle</h2>
  
  <div class="clear"></div>
</hgroup>


<link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:coding-stories.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/digest-js">digest.js</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/a-propos/">About - À Propos</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2011/07/07/code-compare-sha-1-sur-android-ios/">Code Comparé : SHA-1 Sur Android &amp; iOS</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2011-07-07T17:57:00+02:00" pubdate data-updated="true"> 7 jui 2011</time>
        
         | <a href="/blog/2011/07/07/code-compare-sha-1-sur-android-ios/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Problème : on dispose d’un bloc de données dont on désire calculer l’empreinte SHA-1. Deux solutions, sur Android et iOS.</p>

<h1>Android</h1>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>
</span><span class='line'><span class="cm">/* ... */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">computeSHA1</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">MessageDigest</span> <span class="n">dg</span> <span class="o">=</span> <span class="n">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&quot;SHA-1&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">dg</span><span class="o">.</span><span class="na">digest</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>iOS</h1>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &lt;CommonCrypto/CommonDigest.h&gt;</span>
</span><span class='line'><span class="cm">/* ... */</span>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">NSData</span><span class="o">*</span><span class="p">)</span> <span class="nf">computeSHA1:</span><span class="p">(</span><span class="n">NSData</span><span class="o">*</span><span class="p">)</span><span class="nv">input</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">output</span><span class="p">[</span><span class="n">CC_SHA1_DIGEST_LENGTH</span><span class="p">];</span>
</span><span class='line'>    <span class="n">CC_SHA1</span><span class="p">([</span><span class="n">input</span> <span class="n">bytes</span><span class="p">],</span> <span class="p">(</span><span class="n">CC_LONG</span><span class="p">)[</span><span class="n">input</span> <span class="n">length</span><span class="p">],</span> <span class="n">output</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">NSData</span> <span class="nl">dataWithBytes:</span><span class="n">output</span> <span class="nl">length:</span><span class="n">CC_SHA1_DIGEST_LENGTH</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2011/07/02/ssltls-en-java-partie-1/">SSL/TLS en Java – Partie 1</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2011-07-02T21:45:00+02:00" pubdate data-updated="true"> 2 jui 2011</time>
        
         | <a href="/blog/2011/07/02/ssltls-en-java-partie-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>J’ai pensé appeler cet article «<em>Pourquoi SSL ne marche pas ?</em>». En effet j’ai lu beaucoup de questions sur des forums posées par des développeurs qui n’arrivaient pas à faire fonctionner SSL entre le serveur et les clients ; le plus souvent le développeur ne sait pas très bien comment fonctionne le protocole et il n’arrive pas à diagnostiquer les problèmes ; j’espère que cette série article aidera ceux qui se battent encore avec les erreurs du type <code>alert=42</code> (si si, je vous assure que c’est une vraie erreur :)).</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/07/02/ssltls-en-java-partie-1/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2011/05/05/audit-automatique-avec-play-framework/">Audit Automatique Avec Play Framework</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2011-05-05T07:40:00+02:00" pubdate data-updated="true"> 5 mai 2011</time>
        
         | <a href="/blog/2011/05/05/audit-automatique-avec-play-framework/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>J’aime beaucoup l’annotation @With de Play framework, elle permet d’étendre le comportement d’un <em>Controller</em> en y ajoutant simplement des intercepteurs. Par exemple il est possible d’écrire un <em>Controller</em> générique dont le travail est de logguer des appels et d’ajouter ce comportement sur d’autre <em>Controller</em> avec une simple annotation.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2011/05/05/audit-automatique-avec-play-framework/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2011/03/10/analyse-de-la-qualite-logicielle/">Analyse De La Qualité Logicielle</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2011-03-10T07:46:00+01:00" pubdate data-updated="true">10 mar 2011</time>
        
         | <a href="/blog/2011/03/10/analyse-de-la-qualite-logicielle/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Une sympathique session du Lausanne JUG concernant l’analyse de la qualité des logiciels. Le format de la présentation, en forme de « confrontation » (mais pleine de fair-play) me plait assez : cinq éditeurs de logiciels présentent cinq outils (en fait quatre seulement dans la vidéo, le dernier n’ayant semble-t-il pas souhaité être filmé), chacun faisant en 20 minutes la démonstration de ce qu’il peut/sait faire en analysant le même logiciel. En l’occurrence c’est <a href="http://www.icescrum.org/">IceScrum 2</a> qui a servi d’étalon.</p>

<p>Les outils présentés :</p>

<ul>
<li><a href="http://www.sonarsource.org/">Sonar</a></li>
<li><a href="http://www.parasoft.com/jsp/products/jtest.jsp">Parasoft JTest</a></li>
<li><a href="http://www.xdepend.com/">XDepend</a></li>
<li><a href="http://www.headwaysoftware.com/">Structure 101 et Restructure 101</a></li>
<li><a href="http://www.coverity.com/">Coverity Static Analysis et Coverity Dynamic Analysis</a></li>
</ul>


<p>A lire également, sur le blog d’OCTO Technology, les <a href="http://blog.octo.com/retour-jug-lausanne-qualite-code-java/">commentaires et impressions</a> de Cyril Picat qui a organisé l’événement.</p>

<p>Et si jamais quelqu’un du Paris JUG me lit, pourquoi ne pas organiser une session de ce genre ?</p>

<object width="395" height="395">
  <param name="movie" value="http://www.parleys.com/dist/share/parleysshare.swf"/>
  <param name="allowFullScreen" value="true"/>
  <param name="wmode" value="direct"/>
  <param name="bgcolor" value="#222222"/>
  <param name="flashVars" value="sv=true&amp;pageId=2297"/>
  <embed src="http://www.parleys.com/dist/share/parleysshare.swf" type="application/x-shockwave-flash" flashVars="sv=true&amp;pageId=2297" allowfullscreen="true" bgcolor="#222222" width="395" height="395"/>
</object>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2011/01/12/parser-des-parties-dechecs-avec-scala-parser-combinators/">Parser Des Parties D’échecs Avec Scala Parser Combinators</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2011-01-12T07:51:00+01:00" pubdate data-updated="true">12 jan 2011</time>
        
         | <a href="/blog/2011/01/12/parser-des-parties-dechecs-avec-scala-parser-combinators/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Un morceau de code scala écrit il y a quelques mois quand j’ai commencé à jouer avec scala. Il utilise l’API <a href="http://www.scala-lang.org/api/current/scala/util/parsing/combinator/Parsers.html">parser combinators</a> de scala pour décoder des parties d’échecs au format [PGN].</p>

<div><script src='https://gist.github.com/774261.js?file=PGNParser.scala'></script>
<noscript><pre><code></code></pre></noscript></div>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/11/29/afficher-les-videos-de-parleys-dans-confluence/">Afficher Les Vidéos De Parleys Dans Confluence</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-11-29T07:55:00+01:00" pubdate data-updated="true">29 nov 2010</time>
        
         | <a href="/blog/2010/11/29/afficher-les-videos-de-parleys-dans-confluence/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Comment faire quand on désire afficher du contenu multimedia (une vidéo par exemple) dans une page <a href="http://www.atlassian.com/software/confluence/">Confluence</a> ?
Confluence fournit une la <a href="http://confluence.atlassian.com/display/DOC/Embedding+Multimedia+Content">balise wiki</a> dédiée si la ressource à afficher est stockée localement (un attachement dans le wiki par exemple). Une autre solution c’est le plugin widget connector qui est compatible avec des services tels que youtube, vimeo, slideshare… Malheureusement aucune de ces solutions ne permet d’inclure une vidéo issue de <a href="http://www.parleys.com/">Parleys</a>.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2010/11/29/afficher-les-videos-de-parleys-dans-confluence/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/11/22/sommes-nous-des-professionnels/">Sommes-nous Des Professionnels ?</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-11-22T08:11:00+01:00" pubdate data-updated="true">22 nov 2010</time>
        
         | <a href="/blog/2010/11/22/sommes-nous-des-professionnels/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Les vidéos de la conférence Devoxx 2009 sont désormais toutes <a href="http://parleys.com/#id=74957&amp;st=4">librement accessibles</a> ; j’en profite donc pour inciter toute personne travaillant dans le développement logiciel à regarder la <em>keynote</em> de <a href="http://en.wikipedia.org/wiki/Robert_Cecil_Martin">Robert Martin</a> (alias oncle Bob) sur ce que devrait être, et devrait faire, un professionnel du développement logiciel. À Lire également, l’article de wikipedia <a href="http://en.wikipedia.org/wiki/Software_craftsmanship">Software craftsmanship</a>.</p>

<p>Alors certes, rien de bien nouveau dans le discours ; mais il est toujours bon de rappeler les évidences, ne serait-ce que pour nous montrer qu’il nous reste une marge de progression…</p>

<object width="395" height="395">
  <param name="movie" value="http://www.parleys.com/dist/share/parleysshare.swf"/>
  <param name="allowFullScreen" value="true"/>
  <param name="wmode" value="direct"/>
  <param name="bgcolor" value="#222222"/>
  <param name="flashVars" value="sv=true&amp;pageId=1491"/>
  <embed src="http://www.parleys.com/dist/share/parleysshare.swf" type="application/x-shockwave-flash" flashVars="sv=true&amp;pageId=1491" allowfullscreen="true" bgcolor="#222222" width="395" height="395"/>
</object>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/11/03/authentification-ldap-avec-play-framework/">Authentification LDAP Avec Play! Framework</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-11-03T22:42:00+01:00" pubdate data-updated="true"> 3 nov 2010</time>
        
         | <a href="/blog/2010/11/03/authentification-ldap-avec-play-framework/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Il y a quelques semaines j’ai profité de l’écriture d’une petite application web, un outil interne dans ma boîte, pour essayer <a href="http://www.playframework.org/">Play! framework</a>. Chez nous l’authentification passant par un serveur LDAP centralisé, j’ai cherché à interfacer ce type d’authentification avec Play!</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2010/11/03/authentification-ldap-avec-play-framework/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/09/02/signer-les-jars-avec-maven/">Signer Les JARs Avec Maven</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-09-02T23:09:00+02:00" pubdate data-updated="true"> 2 sep 2010</time>
        
         | <a href="/blog/2010/09/02/signer-les-jars-avec-maven/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Après avoir vu cette <a href="http://stackoverflow.com/questions/3598424/jar-signing-strategy-in-maven-projects">question</a> sur stackoverflow j’ai pensé que présenter la façon dont je gère la signature de code avec maven pouvait en intéresser certains.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2010/09/02/signer-les-jars-avec-maven/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/blog/2010/08/24/equals-et-java-lang-reflect-proxy/">Equals() Et java.lang.reflect.Proxy</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-08-24T07:17:00+02:00" pubdate data-updated="true">24 aoû 2010</time>
        
         | <a href="/blog/2010/08/24/equals-et-java-lang-reflect-proxy/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://download.oracle.com/javase/6/docs/api/java/lang/reflect/Proxy.html">java.lang.reflect.Proxy</a> qui a été ajouté dans la bibliothèque standard à partir de Java 1.3 est un de mes jouets préférés. Cette classe permet de créer dynamiquement des instances qui implémentent n’importe quelle liste d’interfaces.</p>

<p>Prenons un exemple :</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserAccount</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="n">Credentials</span> <span class="nf">getCredentials</span><span class="o">();</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">updateCredentials</span><span class="o">(</span><span class="n">Credentials</span> <span class="n">credentials</span><span class="o">);</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">suspend</span><span class="o">();</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">resume</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Avec une classe Proxy on peut fabriquer une instance de `UserAccount qui loggue les appels aux différentes méthodes :</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="n">UserAccount</span> <span class="nf">wrapBad</span><span class="o">(</span><span class="kd">final</span> <span class="n">UserAccount</span> <span class="n">realAccout</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="n">InvocationHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InvocationHandler</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">realAccount</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">method</span> <span class="o">+</span> <span class="s">&quot; called with arguments &quot;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">args</span><span class="o">));</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">};</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">UserAccount</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">(),</span>
</span><span class='line'>        <span class="k">new</span> <span class="n">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="n">UserAccount</span><span class="o">.</span><span class="na">class</span> <span class="o">},</span> <span class="n">handler</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Et là, formidable, chaque appel produit maintenant une ligne de log. Sauf que si on s’arrête là on s’expose à un gag :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>UserAccount account = wrapBad(realAccount);
</span><span class='line'>System.out.println(account.equals(account)); /* &lt;-- affiche false */</span></code></pre></td></tr></table></div></figure>


<p>Et là on se rend compte qu’on a cassé le contrat de <code>Object.equals()</code>. `Object.equals() définit une relation d’équivalence et par conséquent cette relation est réflexive, comme le précise d’ailleurs la javadoc :</p>

<blockquote><p>It is reflexive: for any non-null reference value x, x.equals(x) should return true.</p></blockquote>


<p>Que se passe-t-il exactement ? Premier élément de réponse dans la javadoc de <code>InvocationHandler</code>.</p>

<blockquote><p>An invocation of the hashCode, equals, or toString methods declared in java.lang.Object on a proxy instance will be encoded and dispatched to the invocation handler’s invoke method in the same manner as interface method invocations are encoded and dispatched.</p></blockquote>


<p>Pas de comportement particulier pour <code>equals</code>, si bien que dans notre exemple, l’appel est simplement passé à l’objet `realAccount, avec pour argument, l’objet proxy ce qui va bien sûr renvoyer <em>false</em>.</p>

<p>Voilà une façon de régler le problème :</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyInvocationHandler</span> <span class="kd">implements</span> <span class="n">InvocationHandler</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">UserAccount</span> <span class="n">account</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MyInvocationHandler</span><span class="o">(</span><span class="n">UserAccount</span> <span class="n">account</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">()</span> <span class="o">==</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span>
</span><span class='line'>                <span class="o">&amp;&amp;</span> <span class="n">m</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;equals&quot;</span><span class="o">)</span>
</span><span class='line'>                <span class="o">&amp;&amp;</span> <span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="n">Object</span> <span class="n">o</span> <span class="o">==</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
</span><span class='line'>                <span class="k">return</span> <span class="n">Proxy</span><span class="o">.</span><span class="na">isProxyClass</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">Proxy</span><span class="o">.</span><span class="na">getInvocationHandler</span><span class="o">(</span><span class="n">o</span><span class="o">));</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">realAccount</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">method</span> <span class="o">+</span> <span class="s">&quot; called with arguments &quot;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">args</span><span class="o">));</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">MyInvocationHandler</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">account</span><span class="o">.</span><span class="na">equals</span><span class="o">(((</span><span class="n">MyInvocationHandler</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">account</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="n">UserAccount</span> <span class="nf">wrapGood</span><span class="o">(</span><span class="kd">final</span> <span class="n">UserAccount</span> <span class="n">realAccout</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="n">InvocationHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyInvocationHandler</span><span class="o">(</span><span class="n">realAccount</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">UserAccount</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">(),</span>
</span><span class='line'>        <span class="k">new</span> <span class="n">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="n">UserAccount</span><span class="o">.</span><span class="na">class</span> <span class="o">},</span> <span class="n">handler</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dans cette version corrigée le cas de la méthode <code>equals</code> est gérée à part. Ensuite on considère que deux <em>proxies</em> sont égaux s’ils utilisent la même implémentation de <code>InvocationHandler</code> et que les objets <code>UserAccount</code> encapsulés par ces <em>handlers</em> sont égaux selon equals. Pour cela on utilise deux méthodes intéressantes de la classe <code>Proxy</code> : <code>isProxyClass()</code> qui permet de savoir si un objet est un proxy et <code>getInvocationHandler()</code> qui permet de récupérer le `InvocationHandler lié à un proxy.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/08/23/continuous-delivery-with-jenkins-workflow-and-docker/">Continuous Delivery with Jenkins workflow and Docker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/09/ssl-et-les-banques/">SSL et les banques</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/19/the-secret-of-monkey-island-dans-le-navigateur/">The Secret of Monkey Island dans le navigateur</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/20/code-story-2013/">Code Story 2013 : la phase de sélection</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/21/un-mois-avec-intellij-debut-de-lexperience/">Un mois avec IntelliJ - début de l&#8217;expérience</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("jcsirot", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/jcsirot" class="twitter-follow-button" data-show-count="false">Follow @jcsirot</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/jcsirot?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
  <h1>Category Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/android' style='font-size: 121.81818181818181%'>android</a> <a href='/blog/categories/bytecode' style='font-size: 105.45454545454545%'>bytecode</a> <a href='/blog/categories/chess' style='font-size: 110.9090909090909%'>chess</a> <a href='/blog/categories/cobertura' style='font-size: 110.9090909090909%'>cobertura</a> <a href='/blog/categories/code' style='font-size: 116.36363636363636%'>code</a> <a href='/blog/categories/code-coverage' style='font-size: 105.45454545454545%'>code coverage</a> <a href='/blog/categories/compiler' style='font-size: 105.45454545454545%'>compiler</a> <a href='/blog/categories/conference' style='font-size: 121.81818181818181%'>conference</a> <a href='/blog/categories/confluence' style='font-size: 105.45454545454545%'>confluence</a> <a href='/blog/categories/continuous-delivery' style='font-size: 105.45454545454545%'>Continuous Delivery</a> <a href='/blog/categories/cryptography' style='font-size: 105.45454545454545%'>cryptography</a> <a href='/blog/categories/dart' style='font-size: 110.9090909090909%'>dart</a> <a href='/blog/categories/dartlang' style='font-size: 105.45454545454545%'>dartlang</a> <a href='/blog/categories/devops' style='font-size: 105.45454545454545%'>devops</a> <a href='/blog/categories/devoxx' style='font-size: 110.9090909090909%'>devoxx</a> <a href='/blog/categories/docker' style='font-size: 105.45454545454545%'>Docker</a> <a href='/blog/categories/dvcs' style='font-size: 110.9090909090909%'>DVCS</a> <a href='/blog/categories/ecc' style='font-size: 105.45454545454545%'>ECC</a> <a href='/blog/categories/elliptic-curve' style='font-size: 105.45454545454545%'>elliptic curve</a> <a href='/blog/categories/en' style='font-size: 105.45454545454545%'>en</a> <a href='/blog/categories/framework' style='font-size: 110.9090909090909%'>framework</a> <a href='/blog/categories/git' style='font-size: 110.9090909090909%'>git</a> <a href='/blog/categories/google' style='font-size: 127.27272727272728%'>google</a> <a href='/blog/categories/hero' style='font-size: 105.45454545454545%'>hero</a> <a href='/blog/categories/htc' style='font-size: 105.45454545454545%'>htc</a> <a href='/blog/categories/html5' style='font-size: 105.45454545454545%'>html5</a> <a href='/blog/categories/http' style='font-size: 105.45454545454545%'>HTTP</a> <a href='/blog/categories/https' style='font-size: 110.9090909090909%'>HTTPS</a> <a href='/blog/categories/ide' style='font-size: 105.45454545454545%'>IDE</a> <a href='/blog/categories/intellij' style='font-size: 105.45454545454545%'>IntelliJ</a> <a href='/blog/categories/ios' style='font-size: 105.45454545454545%'>iOS</a> <a href='/blog/categories/jacoco' style='font-size: 105.45454545454545%'>JaCoCo</a> <a href='/blog/categories/java' style='font-size: 160.0%'>java</a> <a href='/blog/categories/java7' style='font-size: 105.45454545454545%'>java7</a> <a href='/blog/categories/javascript' style='font-size: 110.9090909090909%'>javascript</a> <a href='/blog/categories/jenkins' style='font-size: 105.45454545454545%'>Jenkins</a> <a href='/blog/categories/jenkins-workflow' style='font-size: 105.45454545454545%'>Jenkins workflow</a> <a href='/blog/categories/jira' style='font-size: 105.45454545454545%'>jira</a> <a href='/blog/categories/jschessboard' style='font-size: 105.45454545454545%'>jsChessboard</a> <a href='/blog/categories/jug' style='font-size: 110.9090909090909%'>JUG</a> <a href='/blog/categories/junit' style='font-size: 105.45454545454545%'>junit</a> <a href='/blog/categories/keynote' style='font-size: 105.45454545454545%'>keynote</a> <a href='/blog/categories/ldap' style='font-size: 105.45454545454545%'>ldap</a> <a href='/blog/categories/log' style='font-size: 105.45454545454545%'>log</a> <a href='/blog/categories/maven' style='font-size: 121.81818181818181%'>maven</a> <a href='/blog/categories/maven-cobertura-plugin' style='font-size: 105.45454545454545%'>maven-cobertura-plugin</a> <a href='/blog/categories/maven-enforcer-plugin' style='font-size: 105.45454545454545%'>maven-enforcer-plugin</a> <a href='/blog/categories/maven-failsafe-plugin' style='font-size: 105.45454545454545%'>maven-failsafe-plugin</a> <a href='/blog/categories/maven-jacoco-plugin' style='font-size: 105.45454545454545%'>maven-jacoco-plugin</a> <a href='/blog/categories/maven-jarsigner-plugin' style='font-size: 105.45454545454545%'>maven-jarsigner-plugin</a> <a href='/blog/categories/maven-release-plugin' style='font-size: 110.9090909090909%'>maven-release-plugin</a> <a href='/blog/categories/mock' style='font-size: 105.45454545454545%'>mock</a> <a href='/blog/categories/netbeans' style='font-size: 105.45454545454545%'>NetBeans</a> <a href='/blog/categories/objective-c' style='font-size: 105.45454545454545%'>objective-c</a> <a href='/blog/categories/parleys' style='font-size: 116.36363636363636%'>parleys</a> <a href='/blog/categories/pgn' style='font-size: 105.45454545454545%'>PGN</a> <a href='/blog/categories/play' style='font-size: 110.9090909090909%'>play</a> <a href='/blog/categories/proxy' style='font-size: 105.45454545454545%'>proxy</a> <a href='/blog/categories/qualite' style='font-size: 105.45454545454545%'>qualite</a> <a href='/blog/categories/quality' style='font-size: 110.9090909090909%'>quality</a> <a href='/blog/categories/rsa' style='font-size: 105.45454545454545%'>RSA</a> <a href='/blog/categories/scala' style='font-size: 121.81818181818181%'>scala</a> <a href='/blog/categories/scumm' style='font-size: 105.45454545454545%'>SCUMM</a> <a href='/blog/categories/scummdart' style='font-size: 105.45454545454545%'>SCUMMDart</a> <a href='/blog/categories/scummvm' style='font-size: 105.45454545454545%'>ScummVM</a> <a href='/blog/categories/security' style='font-size: 132.72727272727272%'>security</a> <a href='/blog/categories/software-craftsmanship' style='font-size: 105.45454545454545%'>software craftsmanship</a> <a href='/blog/categories/sonar' style='font-size: 110.9090909090909%'>sonar</a> <a href='/blog/categories/spring' style='font-size: 105.45454545454545%'>spring</a> <a href='/blog/categories/ssl' style='font-size: 121.81818181818181%'>SSL</a> <a href='/blog/categories/test' style='font-size: 127.27272727272728%'>test</a> <a href='/blog/categories/tls' style='font-size: 121.81818181818181%'>TLS</a> <a href='/blog/categories/uncle-bob' style='font-size: 105.45454545454545%'>Uncle Bob</a> <a href='/blog/categories/video' style='font-size: 105.45454545454545%'>video</a> <a href='/blog/categories/web' style='font-size: 116.36363636363636%'>web</a> <a href='/blog/categories/wiki' style='font-size: 105.45454545454545%'>wiki</a> </span>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Jean-Christophe Sirot -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> -
  Theme <a href="https://github.com/amelandri/darkstripes">DarkStripes</a> by Alessandro Melandri
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codingst';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'http://platform.linkedin.com/in.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(script, s);
    })();
  </script>





</body>
</html>
